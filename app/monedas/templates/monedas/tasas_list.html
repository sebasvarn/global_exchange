{% extends 'base.html' %}
{% load usuarios_extras %}
{% block title %}Tasas de Cambio{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 mb-0">Tasas de Cambio</h1>
  <!-- Botón Nueva tasa eliminado -->
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col-sm-6">
    <label class="form-label mb-0">Moneda</label>
    <select name="moneda" class="form-select" onchange="this.form.submit()">
      <option value="">Todas</option>
      {% for m in monedas %}
        <option value="{{ m.id }}" {% if m.id|stringformat:'s' == moneda_id %}selected{% endif %}>
          {{ m.codigo }} — {{ m.nombre }}
        </option>
      {% endfor %}
    </select>
    <div class="form-check mt-2">
      <input class="form-check-input" type="checkbox" value="1" id="solo_activas" name="solo_activas" onchange="this.form.submit()" {% if solo_activas %}checked{% endif %}>
      <label class="form-check-label" for="solo_activas">Sólo activas</label>
    </div>

    </div> <!-- Close col-sm-6 -->
  </form>

<div class="card card-outline card-primary">
  <div class="table-responsive">
    <table class="table table-sm table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Moneda</th>
          <th>Compra</th>
          <th>Venta</th>
          <th>Var.%</th>
          <th>Fuente</th>
          <th>Creada</th>
          <th>Activa</th>
        </tr>
      </thead>
      <tbody>
          {% for t in tasas %}
          <tr>
            <td>{{ t.id }}</td>
            <td><span class="badge text-bg-light border">{{ t.moneda.codigo }}</span></td>
            <td>{{ t.compra }}</td>
            <td>{{ t.venta }}</td>
            <td>{{ t.variacion }}%</td>
            <td>{% if t.fuente %}{{ t.fuente }}{% else %}BCP{% endif %}</td>
            <td>{{ t.fecha_creacion|date:"Y-m-d H:i" }}</td>
            <td>
              {% if t.activa %}
                <span class="badge text-bg-success">Sí</span>
              {% else %}
                <form action="{% url 'monedas:tasa_marcar_activa' t.id %}" method="post" class="d-inline">
                  {% csrf_token %}
                  <button class="btn btn-xs btn-outline-success">
                    <i class="bi bi-check2-circle"></i> Activar
                  </button>
                </form>
              {% endif %}
            </td>
            <!-- columna de edición eliminada -->
          </tr>
          {% empty %}
          <tr><td colspan="8" class="text-center">Sin registros.</td></tr>
          {% endfor %}
            </tbody>
          </table>
        </div>
  </div>
{% endblock %}
